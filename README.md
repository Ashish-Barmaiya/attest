<h1 align="center">Attest — Tamper-Evident Audit Service</h1>

<p align="center">
  <b>Tamper-Evident Audit Logging with Cryptographic Verification</b>
</p>

<p align="center">
  <i>Prove your audit history hasn’t been rewritten — even by you.</i>
</p>

---

Attest is a <b>multi-tenant, append-only audit logging service</b> that provides cryptographic proof that audit history has <b>not been silently rewritten</b>.  
Each tenant (project) maintains an isolated audit log with its own hash chain and external anchoring history.

Attest is designed to answer a hard question traditional logging systems cannot:

> <b>“How do you prove that this audit history is the original history?”</b>

### The Problem

Standard audit logs can verify *internal consistency*, but they cannot prove that history itself has not been rewritten.  
A sufficiently powerful attacker — including a malicious operator with full database access — can modify past events, recompute hashes, and present a forged yet internally valid log.

### The Solution

Attest closes this gap by combining:

1. **Hash chaining** — each event cryptographically links to the previous one  
2. **External anchoring** — periodic checkpoints of each project’s audit state are published to an external, append-only system (e.g. Git)

These anchors bind the audit history to a source of truth **outside the control of the database operator**, making history rewrites detectable even if the entire database is compromised.

Attest is intentionally **API-first and verification-centric**.  
Ingestion, storage, and verification are treated as separate concerns so that verification can be performed independently, long after events are written.

---

### See It In Action

![Attest Verification Demo](./assets/attest-demo.gif)

---

## Trust Model

Attest assumes that the application server and database may be compromised.
Integrity guarantees begin only once audit state is anchored to an external system.

**Verification does not trust:**
- The Attest API
- The database
- Anchor metadata stored internally

**Verification trusts only:**
- Cryptographic hash chains
- External anchor history (e.g., Git)

This design allows tampering to be detected even after a full system compromise.

---

## Who This Is For

### Intended Users

- Developers building **security-sensitive or high-assurance systems**
- Security and compliance teams requiring **independently verifiable audit integrity**
- Operators who want tamper-evidence **without blockchains or consensus systems**

### Not Intended Users

- General application logging or analytics
- High-volume telemetry or clickstream data
- Systems requiring mutable history or “right-to-be-forgotten” semantics

---

## Core Concepts

- **Project**  
  A tenant isolation boundary. Each project has its own independent hash chain and anchors.

- **Audit Event**  
  An immutable JSON payload representing an auditable action.

- **Hash Chaining**  
  ```
  chainHash = SHA256(prevChainHash + SHA256(payload))
  ```
  Any modification to historical data invalidates all subsequent hashes.

- **Chain Head**  
  The sequence number and hash of the most recent event in a project.

- **Anchoring**  
  Anchoring publishes cryptographic snapshots of audit state to a system **outside the control of the Attest database**.  
  This prevents silent history rewriting even by a privileged operator. Anchoring is not performed by the API and is not trusted unless verified externally.

---

## Quick Start

1.  **Clone and Setup**:
    ```bash
    git clone https://github.com/your-org/attest.git
    cd attest
    cp .env.example .env
    ```

2.  **Run with Docker**:
    ```bash
    docker-compose up -d
    ```

3.  **Configure Anchoring**:
    -   Set `ANCHOR_MODE=dev` in `.env` for local testing.
    -   Set `ANCHOR_MODE=prod` for production (requires Git configuration).

4.  **Read the Guide**:
    -   See [How to Use Attest](./docs/HOW_TO_USE_ATTEST.md) for full usage instructions.

---

## Key Lifecycle

Attest enforces explicit key management:

1. **Creation**: Keys are generated by the operator.
2. **Rotation**: Rotation is additive (create new -> migrate -> revoke old).
3. **Revocation**: Revoked keys cannot append events, but history remains verifiable.

## Project Lifecycle

Projects are never deleted, only **tombstoned**:

1. **Active**: Normal operation.
2. **Tombstoned**: Permanently closed. No new events, keys, or rotations allowed.
   - History remains verifiable forever.
   - Anchors remain valid.
   - **Irreversible**.

---

## Documentation

- [Architecture](./docs/ARCHITECTURE.md)
- [Security Model](./docs/SECURITY.md)
- [Operations](./docs/OPERATIONS.md)
- [Control Plane & CLI](./docs/CONTROL_PLANE.md)
- [How to Use Attest](./docs/HOW_TO_USE_ATTEST.md)
- [Performance](./docs/PERFORMANCE.md)

---

## Developer Usage (Data Plane)

### Append an Event

Project context is derived **exclusively** from the API key.  
Client-supplied project identifiers are ignored.

```bash
curl -X POST http://localhost:3000/events \
-H "x-api-key: <PROJECT_API_KEY>" \
-H "Content-Type: application/json" \
-d '{
  "action": "login",
  "actor": { "type": "user", "id": "123" },
  "resource": { "type": "session", "id": "321" }
}'
```

### Verify History

Verification can be performed independently at any time.

```bash
# Verifies internal hash integrity and checks against external anchors
attest verify <PROJECT_ID> --anchors /path/to/anchors
```

## Guarantees

### Integrity
Any modification to historical events invalidates the hash chain. Attest **detects** tampering, it does not prevent the database from being modified by a root user.

### Isolation
Projects are fully isolated; cross-tenant influence is impossible.

### Authority
Write access is controlled exclusively via API keys.
No client-supplied identity is trusted.

### Tamper-Evidence
History rewrites — including correctly recomputed chains — are **detected** once anchored externally.

## What Attest Does NOT Do

Attest provides **tamper evidence**, not tamper prevention. It does **not**:

- **Prevent malicious input**: "Garbage in, garbage out".
- **Prevent API key misuse**: If a key is stolen, it can write events (until revoked).
- **Guarantee availability**: It is not a high-availability database.
- **Provide real-time alerts**: Verification is an asynchronous audit process.
- **Replace application-level validation**: It proves *what* happened, not whether it *should* have happened.

Attest is infrastructure for provable audit integrity, not a general logging platform.

## License

Licensed under the Apache License 2.0.  
See [LICENSE](./LICENSE) for details.
